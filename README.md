# 多约束下的智能网络调度赛题思路
## 需求分析

- 每个货物尽量用最短的距离进行规划，最短路径要使得尽量运送尽可能多的货物
- 充分利用拣货员，让货物能尽可能的按照路径进行运输
- 总的来说要使得运送==路径最小化，列车运送重量最大化，拣货员利用率最大化==

## 迪杰斯特拉路径动态规划

- 路径规划分两种情况，一种是无必经站点的路径规划，另一种是有必经站点的路径规划

### 无必经站点的动态规划

#### 单点的动态规划

- 以拓扑图中某一点为起点，利用迪杰斯特拉算法尽量求出此点到其他点的最短路径，并用数组存储，便于查询
- 就如下图1为例，是从Z1点开始对Z1到其他点最短路径的规划
- 首先将Z1点的权重设为0，其他默认为-1，权重weight默认从1开始
- 如图2所示，当Z1搜寻到Z2和Z4，Z2和Z4位置发现权重是-1，weight更新值为1，并在对应位置赋值轨道路径ID。
- weight++，并开始下一轮搜寻
- 如图3所示，当从Z2和Z4开始搜寻时，发现新的节点Z3和Z5，同样的发现两点权重值为-1，更新权重值为2，重复上述过程
- 如图4所示，当此搜寻不能发现新的节点，退出循环
- 并返回需要的路径，比如需要找到Z1到Z3，则返回路径R1->R4，含义是Z1->Z2->Z3

##### 动态规划过程如下图所示：

![](https://note.youdao.com/yws/public/resource/adf77aec0ae71ba353e3748e80655629/xmlnote/654567F712B44602BD7B4474F317B1EE/8287)

<center>图1</center>

![](https://note.youdao.com/yws/public/resource/adf77aec0ae71ba353e3748e80655629/xmlnote/542329C7104746DE9CA66024621B8FD7/8289)

<center>图2</center>

![](https://note.youdao.com/yws/public/resource/adf77aec0ae71ba353e3748e80655629/xmlnote/EDF9B9941B044BEFAA12D6F7DDD8E9F6/8291)

<center>图3</center>

![](https://note.youdao.com/yws/public/resource/adf77aec0ae71ba353e3748e80655629/xmlnote/BA37D8B1806A4E27A83AFCD3DDFB9630/8293)

<center>图4</center>

#### 所有无必经站点货物的路径规划

- 如上过程显示，基本每个不含有必经站点的货物都可通过这种方式规划出路径，每个货物的路径实际上都是一次单点的迪杰斯特拉的路径规划

### 有必经站点的动态规划路径

- 基本原理是和单点的迪杰斯特拉规划是相同的，不过每次规划完路径都要保存之前的路径，==防止出现环路==的情况

#### Z1-Z4含有必经站点Z2的例子

- 优先规划Z1到Z2的路径，如图4可看出规划路径为R1，没有经过其他站点
- 如图5所示，从Z2开始搜寻，但是为了防止再搜寻到Z1，Set中保存曾经经过的节点，不会将其添加至newSet中，防止环路
- 如图6，搜寻到Z4，且下次循环搜寻不到新节点，结束循环，返回Z1-Z4的路径，R5-R3
- 与之前优先规划的Z1到Z2的路径进行拼接，最终路径为R1->R5-R3(解释为Z1-Z2-Z5-Z4)

<img src="https://note.youdao.com/yws/public/resource/adf77aec0ae71ba353e3748e80655629/xmlnote/828D79A844274BC38B4B217848B458E5/8297" style="zoom:80%;" />

<center>图5</center>

<img src="https://note.youdao.com/yws/public/resource/adf77aec0ae71ba353e3748e80655629/xmlnote/363145F9602341AC9759FA98ADBC8AC4/8300" style="zoom:80%;" />

<center>图6</center>

#### 含有必经站点的货物进行路径规划

- 此部分路径规划完毕就可将基本所有货物进行路径规划，有部分货物失败的原因，可能是==起点和目的地本身不可达==，以下表1是规划路径的成功率，总的成功率达到99.61%

##### 所有货物路径规划数据

| 情况标号 | 成功规划路线数 | 总共货物数 | 成功百分比 |
| :------: | :------------: | :--------: | :--------: |
|    1     |      3988      |    4000    |   99.70%   |
|    2     |      4999      |    5000    |   99.98%   |
|    3     |      3998      |    4004    |   99.85%   |
|    4     |      2982      |    3000    |   99.40%   |
|    5     |      2953      |    3000    |   98.43%   |
|    6     |      2501      |    2508    |   99.72%   |
|    7     |      3989      |    4000    |   99.73%   |
|    8     |      3986      |    4000    |   99.65%   |
|   合计   |     29396      |   29512    |   99.61%   |

<center>表1</center>

## 分类货物

- 得出所有货物的规划路径后，将所有货物按照路径和重量再进行分类

### 对所有货物按照路径进行粗分

- 如图7所示，轨道是双向的，Z1-Z2-Z3和Z3-Z2-Z1是相等的，两路径归为一类处理

> **注意：**之前是按轨道作为路径存储，这里需要通过将**经过站点作为路径**进行划分

![](https://note.youdao.com/yws/public/resource/adf77aec0ae71ba353e3748e80655629/xmlnote/0ECFCE09976F4FA7BEDF19D454999208/8303)

<center>图7</center>

### 对路径上的货物按重量进行细分

- 如图8所示，将同一路径下的货物又按照重量进行细分，如按照100kg、10kg和2.5kg划分

![](https://note.youdao.com/yws/public/resource/adf77aec0ae71ba353e3748e80655629/xmlnote/B124B8C2632141E68CFD5F4E21DBFE21/8305)

<center>图8</center>

## 优先级排序处理

- 因为需要尽可能运走更多重量的货物，拣货员作为稀缺资源需要充分利用
- 尽量运走重量大的货物能使得资源能被利用最大化
- 这里是按路径下总重量进行排序的，当该路径下的总重量大时应该优先安排这一路径的货物，保证最大需求，避免因为其他小货物占用资源，导致更多的货物无法正常运输。
- 如图9所示，因为四个不同轨道的10kg的货物分别从两地到达需要卸货，占用了Z2不多的拣货员，导致**大量100kg货物堆积在Z2无法发货**

<img src="https://note.youdao.com/yws/public/resource/adf77aec0ae71ba353e3748e80655629/xmlnote/5A8D7E0DBA8843008FB853B717D5C487/8307" style="zoom:80%;" />

<center>图9</center>

- 将每个路径的货物总重量提取，并以此为依据，对路径进行优先级排序，**路径中总重量最大的货物**优先进行安排

## 货物打包

- **对路径优先排序后，再对路径货物打包处理**
- 针对路径中的货物很多，优先打包处理，使得安排的列车能以最大载重运货
- 如下图10所示进行循环组合，使得总的货物能以最大重量拼车出发
- 先放入最重的货物，再拼车，40kg不能进入，因为框内限制总重量为<=100

![](https://note.youdao.com/yws/public/resource/adf77aec0ae71ba353e3748e80655629/xmlnote/8F688DF7D9FA4FF9A8D8985C29AF6868/8311)

<center>图10</center>

- 一组货物共进退，安排**成功共成功，失败共失败**

## 安排换乘拣货员

- 在从起点出发的货物，中途如果不需要换车则不需要拣货员
- 之前的操作已经最少的使用拣货员
- 但是如下图11所示，如果出现列车被占用的情况就必须通过换乘才能到达终点，如Z1到Z2蓝色列车不可用，就只能使用红色列车
- 换乘的拣货员需要两个，需要在前一轨道卸货、后一轨道装货，因此需要两名拣货员

![](https://note.youdao.com/yws/public/resource/adf77aec0ae71ba353e3748e80655629/xmlnote/91BA7217CC6E4EF1841E7171BD1C400A/8313)

<center>图11</center>

## 剩余货物单个处理

- 先将剩余货物按照重量排序，还是将重量重的优先安排
- 与轨道中还有余重的列车再进行拼车，充分利用剩余空间。

## 还需改进之处

- 汇聚场景因为需要同时考虑轨道载重量和拣货员位置与数量，效果不好，因此模拟汇聚场景是本次规划还需改进之处
